<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<title>Jogo de Carro 2D Realista (som automático)</title>
<style>
  body {margin:0;overflow:hidden;background:#4a4a4a;font-family:sans-serif;}
  #hud {
    position:absolute;top:15px;left:50%;transform:translateX(-50%);
    background:rgba(255,255,255,0.85);padding:12px 28px;border-radius:12px;
    font-weight:700;font-size:22px;z-index:10;box-shadow:0 0 10px rgba(0,0,0,0.3);
  }
  #gameOver {
    display:none;position:absolute;inset:0;background:rgba(0,0,0,0.75);
    color:#f44;flex-direction:column;justify-content:center;align-items:center;
    font-size:32px;font-weight:700;z-index:20;
  }
  #gameOver button{
    margin-top:25px;padding:14px 30px;font-size:20px;border:none;border-radius:8px;
    background:#f44;color:#fff;font-weight:700;cursor:pointer;box-shadow:0 0 12px #f44;
    transition:background .3s ease;
  }
  #gameOver button:hover{background:#b32b2b;box-shadow:0 0 18px #b32b2b;}
  canvas{display:block;background:#606060;box-shadow:inset 0 0 15px 2px #444;}
</style>
</head>
<body>
  <div id="hud">PONTUAÇÃO: <span id="score">0</span></div>
  <div id="gameOver">
    <div id="msg">COLIDIU!</div>
    <div>PONTUAÇÃO FINAL: <span id="finalScore">0</span></div>
    <button onclick="restart()">REINICIAR</button>
  </div>
  <canvas id="game"></canvas>

<script>
const canvas=document.getElementById("game"),ctx=canvas.getContext("2d");
canvas.width=innerWidth;canvas.height=innerHeight;

const lanes=[canvas.width/2-150,canvas.width/2,canvas.width/2+150];
const car={x:lanes[1],y:canvas.height-160,w:60,h:110,lane:1,targetX:lanes[1]};
const obstacles=[];let score=0,gameOver=false,speed=4.5,spawnTimer=0,roadOffset=0;

// === Sons locais ===
const ambient=new Audio("motor.mp3"); ambient.loop=true; ambient.volume=0.4;
const crashSound=new Audio("crash.mp3");

// Toca o som automaticamente (requer interação do usuário em alguns navegadores)
document.addEventListener("click",()=>{
  if(ambient.paused) ambient.play();
},{once:true});

function drawCar(c,color="#223344"){
  ctx.save();ctx.translate(c.x,c.y);
  ctx.fillStyle=color;ctx.shadowColor="#222";ctx.shadowBlur=8;
  ctx.beginPath();ctx.moveTo(-c.w/2+10,0);ctx.lineTo(c.w/2-10,0);
  ctx.lineTo(c.w/2-15,c.h*0.55);ctx.lineTo(-c.w/2+15,c.h*0.55);
  ctx.closePath();ctx.fill();
  ctx.fillStyle=lightenColor(color,30);ctx.shadowBlur=5;
  ctx.fillRect(-c.w/2+15,0,c.w-30,c.h*0.22);
  ctx.shadowBlur=0;ctx.fillStyle="#99aabbcc";
  ctx.fillRect(-c.w/4,c.h*0.06,c.w/2,c.h*0.25);
  ctx.fillStyle="#111";const r=12;
  ctx.beginPath();ctx.ellipse(-c.w/3,c.h*0.8,r,r*0.55,0,0,Math.PI*2);ctx.fill();
  ctx.beginPath();ctx.ellipse(c.w/3,c.h*0.8,r,r*0.55,0,0,Math.PI*2);ctx.fill();
  ctx.restore();
}

function lightenColor(hex,amt){let usePound=false;
  if(hex[0]=="#"){hex=hex.slice(1);usePound=true;}
  let num=parseInt(hex,16);
  let r=(num>>16)+amt;r=Math.min(255,Math.max(0,r));
  let g=((num>>8)&0x00FF)+amt;g=Math.min(255,Math.max(0,g));
  let b=(num&0x0000FF)+amt;b=Math.min(255,Math.max(0,b));
  return(usePound?"#":"")+r.toString(16).padStart(2,"0")+g.toString(16).padStart(2,"0")+b.toString(16).padStart(2,"0");
}

function drawRoad(){
  const w=460;const grad=ctx.createLinearGradient(0,0,0,canvas.height);
  grad.addColorStop(0,"#555");grad.addColorStop(1,"#333");
  ctx.fillStyle=grad;ctx.fillRect(canvas.width/2-w/2,0,w,canvas.height);
  ctx.strokeStyle="#eee";ctx.lineWidth=6;ctx.beginPath();
  ctx.moveTo(canvas.width/2-w/2+20,0);ctx.lineTo(canvas.width/2-w/2+20,canvas.height);
  ctx.moveTo(canvas.width/2+w/2-20,0);ctx.lineTo(canvas.width/2+w/2-20,canvas.height);ctx.stroke();
  ctx.strokeStyle="#ddd";ctx.lineWidth=5;ctx.setLineDash([35,35]);
  ctx.lineDashOffset=-roadOffset;ctx.beginPath();
  ctx.moveTo(canvas.width/2,0);ctx.lineTo(canvas.width/2,canvas.height);
  ctx.stroke();ctx.setLineDash([]);
}

function updateObstacles(){
  obstacles.forEach((o,i)=>{
    o.y+=speed;
    if(o.y>canvas.height){
      obstacles.splice(i,1);
      score+=10;
      document.getElementById("score").textContent=score;
    }
    if(o.y+o.h>car.y&&o.y<car.y+car.h&&Math.abs(o.x-car.x)<(o.w/2+car.w/2)){
      endGame();
    }
  });
}

function spawnObstacle(){
  const lane=Math.floor(Math.random()*3);
  const colors=["#883333","#334466","#665533"];
  obstacles.push({x:lanes[lane],y:-120,w:60,h:110,color:colors[Math.floor(Math.random()*colors.length)]});
}

function loop(){
  if(gameOver)return;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawRoad();
  car.x+=(car.targetX-car.x)*0.18;
  drawCar(car,"#225577");
  obstacles.forEach(o=>drawCar(o,o.color));
  updateObstacles();
  spawnTimer++;
  if(spawnTimer>90){spawnObstacle();spawnTimer=0;}
  roadOffset+=speed*0.8;if(roadOffset>70)roadOffset=0;
  requestAnimationFrame(loop);
}

function endGame(){
  gameOver=true;
  ambient.pause();
  crashSound.currentTime=0;
  crashSound.play();
  document.getElementById("finalScore").textContent=score;
  document.getElementById("gameOver").style.display="flex";
}

window.restart=function(){
  obstacles.length=0;car.lane=1;car.x=lanes[1];car.targetX=lanes[1];
  score=0;speed=4.5;
  document.getElementById("score").textContent=score;
  gameOver=false;
  document.getElementById("gameOver").style.display="none";
  ambient.currentTime=0;ambient.play();
  loop();
};

document.addEventListener("keydown",e=>{
  if(e.key==="ArrowLeft"||e.key==="a"){if(car.lane>0)car.lane--;}
  if(e.key==="ArrowRight"||e.key==="d"){if(car.lane<2)car.lane++;}
  car.targetX=lanes[car.lane];
});

setInterval(()=>{if(!gameOver&&speed<12)speed+=0.25;},5000);
addEventListener("resize",()=>{canvas.width=innerWidth;canvas.height=innerHeight;});
loop();
</script>
</body>
</html>
